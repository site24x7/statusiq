<!-- Below code is to seperate Historic Maintenance and Historic Incident in Incident History section -->

<!-- Paste the following into your Custom Footer section -->
<script>
$(document).ready(function() {
  if (window.location.href.indexOf('incident_history') !== -1) {
    return;
  }

  // Get the date headers from the existing cards in #spIncidentHistory
  var days = [];
  $('#spIncidentHistory .card').each(function() {
    var dateText = $(this).find('h3').first().text().trim();
    if (dateText) {
      days.push(dateText);
    }
  });

  var $maintenanceContainer = $('<div id="maintenance-cards"><h2 class="h3 ml-0 ml-sm-3">Historic Maintenance</h2></div>');
  var $incidentContainer = $('<div id="incident-cards"><h2 class="h3 ml-0 ml-sm-3">Historic Incident</h2></div>');

  // For each day, build a card for maintenance and incident
  days.forEach(function(dayStr) {
    // Find the card for this date
    var $card = $('#spIncidentHistory .card').filter(function() {
      return $(this).find('h3').first().text().trim() === dayStr;
    }).first();

    var $dateHeader = $('<h3 class="h4 mt-0 mb-2">' + dayStr + '</h3>');
    var $border = $('<div class="border-bottom"></div>');

    // Maintenance section
    var $maintCard = $('<div class="card px-3 py-2 mb-2"></div>');
    $maintCard.append($dateHeader.clone(), $border.clone());
    if ($card.length) {
      var $entries = $card.children('.py-2.mb-2, .my-3');
      var $maintEntries = $entries.filter(function() {
        return $(this).find('.maintenance').length > 0;
      });
      if ($maintEntries.length) {
        $maintEntries.each(function() { $maintCard.append($(this).clone()); });
      } else {
        $maintCard.append('<div class="my-3 text-muted">No maintenance has been reported.</div>');
      }
    } else {
      $maintCard.append('<div class="my-3 text-muted">No maintenance has been reported.</div>');
    }
    $maintenanceContainer.append($maintCard);

    // Incident section
    var $incidentCard = $('<div class="card px-3 py-2 mb-2"></div>');
    $incidentCard.append($dateHeader.clone(), $border.clone());
    if ($card.length) {
      var $entries = $card.children('.py-2.mb-2, .my-3');
      var $incidentEntries = $entries.filter(function() {
        return $(this).find('.maintenance').length === 0;
      });
      if ($incidentEntries.length) {
        $incidentEntries.each(function() { $incidentCard.append($(this).clone()); });
      } else {
        $incidentCard.append('<div class="my-3 text-muted">No incidents have been reported.</div>');
      }
    } else {
      $incidentCard.append('<div class="my-3 text-muted">No incidents have been reported.</div>');
    }
    $incidentContainer.append($incidentCard);
  });

  $('#spIncidentHistory').empty().append($maintenanceContainer, $incidentContainer);
});
</script>
